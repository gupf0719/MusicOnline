{{template "header"}}

		<title>MusicOnline Stage</title>

		<script src="/static/js/jquery-1.12.3.js" type="text/javascript"></script>
			<script type="text/javascript">

			var root = "/static/music/";
			var path = [];

			$(document).ready(
				function (){
					load(path);
					$('#player').bind('ended', next);
				}
			);

			function load(path)  {
				var url = root+path.join('/');
				$.ajax({
						url: url,
						dataType: "json",
						success: function(data) {
							listFile(data)
						}
					});
			}

			function listFile(files) {
				var $b = $('#playlist').empty();
				function addToList(i, f) {
					if (f.Name[0] == '.' || f.Name[0] == ':') return;
			    	var dir = f.IsDir;
					if(dir) return;
					f.Path = path.join('/');
					$('<a></a>').text(f.Name).data('file', f)
						.addClass("file")
						.appendTo($b)
						.click(clickFile);
				}
				$.each(files, addToList);
			}

			function clickFile(e) {
				var f = $(e.target).data('file');
				var name = f.Name;
				var path = f.Path;
				var url = root+path+'/'+name;
				$(e.target).addClass('playing')
				$('#player').attr('src', url);
			}


			function next() {
				var $next = $('#playlist a.playing').next();
				if ($next.length) $next.click();
			}

		</script>
	</head>

	<body>
		<div class="navbar navbar-default navbar-inverse  navbar-fixed-top">
			<div class="container">
				{{template "navbar" .}}
			</div>
		</div>

		<div class="container" >
			<h1>音乐列表</h1>
			<br/>
			<div id="playlist" style="border-radius: 10px;

						width: 300px;

						height: 36px;
						overflow: auto;
						background: #3CB371;">
					</div>
			<audio id="player" controls autoplay autobuffer >
				<p>What? Your browser doesn't support</p>
			</audio>
			<br/><br/><br/>
			<table class="table table-striped">
				<thead>
					<tr>
						<th>#</th>
						<th>音乐名称</th>
						<th>歌手</th>
						<th>专辑</th>
						<th>分类</th>
						<th>操作</th>
					</tr>
				</thead>
				{{range .Music}}
				<tbody>
					<th>{{.Id}}</th>
					<th>{{.Name}}</th>
					<th>{{.Singer}}</th>
					<th>{{.Special}}</th>
					<th>{{.Category}}</th>
					<th><a href="/music?tid={{.Id}}">播放</a>
				</tbody>
				{{end}}
			</table>
		</div>



		<script type="text/javascript" src="http://cdn.staticfile.org/jquery/2.1.1-rc2/jquery.min.js"></script>
		<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
	</body>
</html>
